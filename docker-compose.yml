services:
  service-agent-voice:
    image: service-agent-voice:latest
    build:
      context: .
      dockerfile: Dockerfile
    container_name: service-agent-voice
    restart: unless-stopped
    ports:
      - "8000:8000"
    environment:
      # External gRPC/HTTP routes
      - STT_SERVICE_HOST=${STT_SERVICE_HOST:-host.docker.internal}
      - STT_SERVICE_PORT=${STT_SERVICE_PORT:-5002}
      - TRANSLATE_SERVICE_HOST=${TRANSLATE_SERVICE_HOST:-host.docker.internal}
      - TRANSLATE_SERVICE_PORT=${TRANSLATE_SERVICE_PORT:-5001}
      - TTS_HTTP_URL=${TTS_HTTP_URL:-http://host.docker.internal:8004}
      - TTS_STREAM_URL=${TTS_STREAM_URL:-ws://host.docker.internal:8004/ws/tts-stream}
      # Structured flow logs for conversation tracing
      - FLOW_LOG_LEVEL=${FLOW_LOG_LEVEL:-INFO}
      - FLOW_LOG_PARTIALS=${FLOW_LOG_PARTIALS:-0}
      - FLOW_LOG_DISABLED=${FLOW_LOG_DISABLED:-0}
    extra_hosts:
      - "host.docker.internal:host-gateway"
